# 笔记

1. hex、bin文件区别

    hex文件包含地址信息。在用ISP方式烧写程序时，我们都有这样的经验：1)选择单片机型号；2)选择串口号；3)设置波特率(或者默认)；4)选择下载的文件；5)点击下载按钮下载。如下图所示。经过这几步后，程序下载工作就完成了，在以上的步骤中我们并没有选择要把程序下载到单片机的哪块内存中，即不需要设置地址。**因为HEX文件内部的信息已经包括了地址**。而烧写BIN文件的时候，用户是一定需要指定地址信息的。

1. 内核空间、用户空间

    对 32 位操作系统而言，它的寻址空间（虚拟地址空间，或叫线性地址空间）为 4G（2的32次方）。也就是说一个进程的最大地址空间为 4G。操作系统的核心是内核(kernel)，它独立于普通的应用程序，可以访问受保护的内存空间，也有访问底层硬件设备的所有权限。为了保证内核的安全，现在的操作系统一般都强制用户进程不能直接操作内核。具体的实现方式基本都是由操作系统将虚拟地址空间划分为两部分，一部分为内核空间，另一部分为用户空间。针对 Linux 操作系统而言，最高的 1G 字节(从虚拟地址 0xC0000000 到 0xFFFFFFFF)由内核使用，称为内核空间。而较低的 3G 字节(从虚拟地址 0x00000000 到 0xBFFFFFFF)由各个进程使用，称为用户空间。

1. 嵌入式（系统）理解？

    嵌入式系统有别于通用计算机（PC），嵌入式系统强调以**应用**为中心，以计算机技术为基础，软硬件可配置（需要什么功能就应该添加什么硬件以及实现相关软件驱动、应用，比如电饭煲温度调控），对功能、可靠性、成本、体积、功耗有严格约束的专用计算机（只适用于某种特定场景的应用，相较于PC体积更小、功耗较小，对实时性、可靠性要求更高）。（实时性：wxworks导弹发射）

    一般的嵌入式系统没有用到操作系统，只是由一个单个程序实现整个控制逻辑（通俗讲就是在主函数的一个while循环里面轮询地执行整个功能），比如51单片机。当然当这个嵌入式处理器具有中断功能时，比如STM32，便可实现以中断触发的前后台处理模式，避免了轮询模式对CPU资源造成的浪费（每次对每个外设都要询问一便，有时候有些外设时不工作的；有些外设速度快，已经准备好被系统读取，但是由于轮询一定要先询问完前面的外设才能轮到这个外设，降低了实时响应性），能够协调各种外设间的速度差异，提高系统的工作效率。当然有些情形下嵌入式系统用到了操作系统会让整个系统更加合适一些。就我个人项目开发经历而言，移植了操作系统后开发难度降低了很多，整个工程的结构看着也很清晰、很舒适。比如我又两个任务，一个需要一秒执行依次，一个需要三秒执行一次。如果没有操作系统，那么我一般就会用到两个定时器，一个定时器中断一秒触发一次、另一个三秒，并将这两个任务要做的事情分别放到两个中断处理函数里面就行。但是有操作系统就不一样了，首先不需要自己实现延时函数（delay.c），比如ucosii就有提供OSTimeDly()等一系列api，我们只要配置好系统时钟中断就可以了。其次，要实现两个任务，只要调用OSTaskCreate()建立两个任务，然后再两个任务函数里面的while()循环里面一个delay1秒、一个3秒就行。如果还要增加一个任务，只要再OSTaskCreate就行，不用再使用额外的定时器。虽然在任务调度、上下文切换的时候操作系统会消耗一点CPU资源，但是优秀的实时调度算法可以很好地克服这些缺点，比如ucosii的优先级位图法。

    所以我现在做的四轴项目正是在体验、深入了解嵌入式系统这么一个过程。

1. OSTaskCreate做的事情

    首先创建任务时会指定一个优先级，ucosii一般有64个优先级，一开始程序会检查该优先级是否已经被其他任务占用，如果占用则直接退出创建任务。

    若没有其他任务占用，然后就会进行任务堆栈初始化以及任务TCB初始化。操作系统在初始化时会创建64个空的任务TCB结构体，TCB结构体包括栈顶指针、延时数、状态、优先级等变量，TCB初始化时会对他们赋值。

    TCB初始化完成后，再判断操作系统是否正在运行，如果在运行则直接进行任务调度，从就绪队列中找到最高优先级任务执行。如果操作系统没在运行，则退出OSTaskCreate，完成任务的创建。

1. 优先级位图法

    当需要从就绪队列找出最高优先级任务时则用到了优先级位图法。因为如果采用遍历就绪队列中所有TCB的话时间复杂度时O(n)，这是个不确定的量，依赖于当前就绪队列任务数。为了做到实时性，采用牺牲空间换取时间的方法实现了时间复杂度O(1)。OSRdyGrp、OSRdyTbl[]表示哪些优先级的任务就绪

    * 使任务进入就绪队列：

        ```c
        OSRdyGrp |= ptcb->OSTCBBitY;
        OSRdyTbl[ptcb->OSTCBY] |= ptcb->OSTCBBitX;
        ```

    * 从就绪队列中找出最高优先级：

        ```c
        y = OSUnMapTbl[OSRdyGrp];
        OSPrioHighRdy = (y<<3) + OSUnMapTbl[OSRdyTbl[y]];
        ```

1. Linux基本操作？

    文件查找、删除、复制、移动、修改；gcc命令；

1. git基本操作？

    1. *基本操作*

        建立git仓库：git init

        复制远程： git clone ssh://user@domain.com/repo.git

        添加文件到缓存区： git add [files]

        提交commit： git commit -m "xxx"

        提交到远程仓库： git push origin master

        拉取远程仓库文件： git pull

    1. *分支管理*

        添加分支： git checkout -b [newbranch]

        删除分支： git branch -d [branch]

        切换分支： git checkout [branch]

        合并分支： git merge [branch]

    1. 版本回退：

        回退到指定版本： git reset --hard [commitid]

1. C语言掌握程度？

    指针大小：32机器上四个字节，64位机器上八个字节

1. arm汇编作用？

    直接操作处理器的寄存器，任务上下文切换需要对处理器的寄存器进行保存和恢复，所以要用到汇编

1. Altium Designer掌握程度？

    能设计元器件封装并绘制原理图、PCB板

1. 逻辑分析仪怎么用？

    分析一段时间的方波时序

1. CAN总线？

1. X86、arm处理器体系结构？

1. Java、C++特性？

1. makefile?

    makefile就像一个Shell脚本一样

1. CPSR寄存器

    [7:0]: 控制位，其中[4:0]位为模式位（用户、快中断、中断、管理、中止、未定义、系统），[7]位为IRQ中断标志，[6]FIQ中断标志，[5]工作状态位：thumb、ARM状态

    [27:8]:保留

    [31:28]:由高到低分别为N(负数位)、Z(零位)、C(借位位)、O(溢出位)

1. B、BL、BLX

    B：直接跳转

    BL：跳转前将PC保存在LR

    BX:跳转时切换状态,最低位为1切换成thumb状态,最低为为0切换成ARM状态(ARM寻址的地址总是2的倍数,如GPIOA的DATA寄存器地址为0x40004000,GPIOA的ODR寄存器地址为0x4000450C,它们的最低位都为0)

1. thumb、ARM、thumb-2

    * ARM状态:arm处理器工作于**32位**指令的状态，所有指令均为32位

    * thumb状态:arm执行**16位**指令的状态，即16位状态

    * thumb-2状态:这个状态是ARM7版本的ARM处理器所具有的新的状态，新的thumb-2内核技术**兼有16位及32位指令**，实现了更高的性能，更有效的功耗及更少地占用内存。总的来说，感觉这个状态除了兼有arm和thumb的优点外，还在这两种状态上有所提升，优化。

1. ucosii 任务调度、上下文切换？

    任务调度时机：任务创建时、操作系统开始时、任务进入等待队列中、时钟中断结束有任务进入就绪队列。

    上下文切换：保存当前任务现场（PC、R0-R12、LR、CPSR），切换到新任务，恢复新任务堆栈现场

1. NOR flash、NAND flash

    NOR flash：较长时间抹写，但是提供完整寻址与数据总线。

    NAND flash：较快抹写速度，但是只能以块的形式进行读写。

1. cortex-m3m4启动过程

    1. 初始化堆栈指针SP=_initial_sp : STM32的中断向量表规定第一行必须是SP地址，第二行是复位中断入口地址，上电后，CPU首先就会读这两个值，分别存为SP和PC寄存器。上述流程第一行_initial_sp就是SP地址。

    1. 初始化PC指针，令其=Reset_Handler

    1. 初始化中断向量表

    1. 配置系统时钟

    1. 调用C库函数_main(_main是IDE自带的mcu初始化程序，包括堆栈、ram等初始化并自动跳转到main)

1. STM32时钟树、中断机制？

    时钟树配置:HSI、HSE、PLL（HSI、HSE、（/M *N /P））-> SYSCLK

    中断机制：启动文件里面已经建立了中断向量表，向量表里面分别存储了对应中断处理函数的地址

1. PCB电气设计规范？

1. 互补滤波算法？

1. PID？

1. DMA

1. 问面试官问题

    只能工作3个月吗？学院要求有6个月的实习期。房补餐补。
